import numpy as np
from climada.entity import ImpactFunc, ImpactFuncSet

# =============================================================================
# Conversion from PAGER building classification to Flood impact category
# from https://nhess.copernicus.org/articles/19/1703/2019/
# =============================================================================

DICT_PAGER_FLIMPF_IVM = {
    'A': 1,  # added manually, corresponds to ADB
    'ADB': 1,
    'ERTH': 1,
    'INF': 1,
    'M': 1,
    'RE': 1,
    'WWD': 1,
    'W1': 2,  # added manually, was not available in paper
    'W2': 2,
    'WLI': 2,
    'WS': 2,
    'BRK': 3,
    'CB': 3,
    'DS': 3,
    'STN': 3,
    'RS1': 2,  # added manually, was not available in paper
    'RS2': 3,  # added manually, was not available in paper
    'RS3': 3,  # added manually, was not available in paper
    'RS4': 3,  # added manually, was not available in paper
    'UCB': 4,
    'UFB': 4,
    'BTLR': 4,
    'C': 4,  # added manually, corresponds to any C-X
    'C2': 4,
    'C3': 4,
    'MCF': 4,
    'RC': 4,
    'RM': 4,
    'S': 4}

# =============================================================================
# Bulding-type wise Flood impact functions
# from https://nhess.copernicus.org/articles/19/1703/2019/
# =============================================================================

impf_fl_I = ImpactFunc(
    id=1,
    name='Flood impact function class I',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    mdd=np.linspace(1, 1, num=11),
    paa=np.array([0, 0.5, 0.9, 1, 1, 1, 1, 1, 1, 1, 1]),
)

impf_fl_II = ImpactFunc(
    id=2,
    name='Flood impact function class II',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    mdd=np.linspace(1, 1, num=11),
    paa=np.array([0, 0.45, 0.7, 0.85, 0.95, 1, 1, 1, 1, 1, 1]),
)


impf_fl_IIIa = ImpactFunc(
    id=3,
    name='Flood impact function class III - one storey',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    mdd=np.linspace(1, 1, num=11),
    paa=np.array([0, 0.4, 0.55, 0.7, 0.78, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8]),
)

impf_fl_IIIb = ImpactFunc(
    id=5,
    name='Flood impact function class III - two storeys',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    mdd=np.linspace(1, 1, num=11),
    paa=np.array([0, 0.25, 0.4, 0.5, 0.58, 0.65, 0.7, 0.75, 0.78, 0.8, 0.8]),
)

impf_fl_IVa = ImpactFunc(
    id=4,
    name='Flood impact function class IV - one storey',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    mdd=np.linspace(1, 1, num=11),
    paa=np.array([0, 0.35, 0.45, 0.55, 0.62, 0.65,
                 0.65, 0.65, 0.65, 0.65, 0.65]),
)


impf_fl_IVb = ImpactFunc(
    id=6,
    name='Flood impact function class IV - two storeys',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    mdd=np.linspace(1, 1, num=11),
    paa=np.array([0, 0.2, 0.3, 0.4, 0.45, 0.5, 0.55, 0.6, 0.63, 0.65, 0.65]),
)

IMPF_SET_FL_IVM = ImpactFuncSet([impf_fl_I, impf_fl_II, impf_fl_IIIa,
                                 impf_fl_IIIb, impf_fl_IVa, impf_fl_IVb])


# =============================================================================
# Conversion from PAGER building classification to CIMA (CAPRA? JRC?)
# building type classification from excel file
# =============================================================================
DICT_PAGER2CIMA = {'A': 'T1',
                   'A1': 'T1',
                   'A2': 'T1',
                   'A3': 'T1',
                   'A4': 'T1',
                   'C': 'C1',
                   'C1': 'C1',
                   'C1H': 'C1',
                   'C1L': 'C1',
                   'C1M': 'C1',
                   'C2': 'C2',
                   'C2L': 'C2',
                   'C3': 'C4',
                   'C3L': 'C4',
                   'C3M': 'C4',
                   'C4': 'C4',
                   'CH': 'C1',
                   'CL': 'C1',
                   'CM': 'C1',
                   'DS': 'M1',
                   'DS1': 'M1',
                   'DS2': 'M1',
                   'DS3': 'M1',
                   'DS4': 'M1',
                   'INF': 'W1',
                   'M': 'T1',
                   'M2': 'T1',
                   'MH': 'W1',
                   'MS': 'M1',
                   'PC': 'C5',
                   'PC1': 'C5',
                   'PC2': 'C5',
                   'PC2L': 'C5',
                   'RE': 'T1',
                   'RM': 'M1',
                   'RM1': 'M1',
                   'RM1L': 'M1',
                   'RM2': 'M2',
                   'RM2H': 'M2',
                   'RM2L': 'M2',
                   'RM2M': 'M2',
                   'RS': 'M1',
                   'RS1': 'M1',
                   'RS2': 'M1',
                   'RS3': 'M1',
                   'RS4': 'M1',
                   'RS5': 'M1',
                   'S': 'C1',
                   'S1': 'C1',
                   'S1H': 'C1',
                   'S1L': 'C1',
                   'S1M': 'C1',
                   'S2': 'C2',
                   'S2L': 'C2',
                   'S3': 'C4',
                   'S4': 'C4',
                   'S4H': 'C4',
                   'S4L': 'C4',
                   'S4M': 'C4',
                   'S5': 'C5',
                   'S5L': 'C5',
                   'UCB': 'M1',
                   'UFB': 'M1',
                   'UFB1': 'M1',
                   'UFB2': 'M1',
                   'UFB3': 'M1',
                   'UFB4': 'M1',
                   'UNK': 'T1',
                   'W': 'W1',
                   'W1': 'W1',
                   'W2': 'W2',
                   'W4': 'W2'}

DICT_CIMA_FLIMPF_CIMA = {'C1': 1,
                         'C4': 2,
                         'C5': 3,
                         'C30': 4,
                         'M1': 5,
                         'M2': 6,
                         'M3': 7,
                         'M4': 8,
                         'M5': 9,
                         'R1': 10,
                         'T1': 11,
                         'T2': 12,
                         'W1': 13,
                         'W2': 14}

# =============================================================================
# Bulding-type wise Flood impact functions
# from CIMA (CAPRA? JRC?)
# =============================================================================


impf_fl_c1 = ImpactFunc(
    id=1,
    name='Flood impact function class C1',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0, 0.0966, 0.1931, 0.2897, 0.3862, 0.4828, 0.5793, 0.6759,
                        0.7724, 0.869, 0.9655, 1.0621, 1.1586, 1.2552, 1.3517,
                        1.4483, 1.5448, 1.6414, 1.7379, 1.8345, 1.931, 2.0276,
                        2.1241, 2.2207, 2.3172, 2.4138, 2.5103, 2.6069,
                        2.7034, 2.8]),
    mdd=np.array([0, 0, 0, 0, 0.0006, 0.0024, 0.0048, 0.009, 0.0156, 0.0258,
                  0.0402, 0.0594, 0.0846,
                  0.1158,
                  0.153,
                  0.1962,
                  0.2442,
                  0.2952,
                  0.348,
                  0.399,
                  0.4464,
                  0.4884,
                  0.5232,
                  0.5502,
                  0.5694,
                  0.5832,
                  0.591,
                  0.5958,
                  0.5982,
                  0.6]),
    paa=np.linspace(1, 1, num=30))

impf_fl_c4 = ImpactFunc(
    id=2,
    name='Flood impact function C4,
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.3448,
                        0.6897,
                        1.0345,
                        1.3793,
                        1.7241,
                        2.069,
                        2.4138,
                        2.7586,
                        3.1034,
                        3.4483,
                        3.7931,
                        4.1379,
                        4.4828,
                        4.8276,
                        5.1724,
                        5.5172,
                        5.8621,
                        6.2069,
                        6.5517,
                        6.8966,
                        7.2414,
                        7.5862,
                        7.931,
                        8.2759,
                        8.6207,
                        8.9655,
                        9.3103,
                        9.6552,
                        10])
    mdd=np.array([0,
                  0,
                  0.0006,
                  0.0024,
                  0.0078,
                  0.0198,
                  0.042,
                  0.0762,
                  0.1218,
                  0.174,
                  0.2232,
                  0.2616,
                  0.285,
                  0.2958,
                  0.2988,
                  0.3,
                  0.3,
                  0.3012,
                  0.3042,
                  0.3132,
                  0.33,
                  0.3576,
                  0.3978,
                  0.4476,
                  0.4992,
                  0.5442,
                  0.5748,
                  0.5916,
                  0.5976,
                  0.6]),
    paa=np.linspace(1, 1, num=30),
)


IMPF_SET_FL_CIMA = ImpactFuncSet([impf_fl_c1, impf_fl_c4])
