import numpy as np
import pandas as pd
import pathlib

from climada.entity import ImpactFunc, ImpactFuncSet
from climada.entity.impact_funcs.trop_cyclone import ImpfTropCyclone

PATH_CSV_TC_AGG = pathlib.Path(
    str(pathlib.Path(__file__).parent.resolve()), 'data/IF_TC_agg.csv')

# =============================================================================
# Conversion from PAGER building classification to Flood impact category
# from https://nhess.copernicus.org/articles/19/1703/2019/
# =============================================================================

DICT_PAGER_FLIMPF_IVM = {
    'A': 1,  # added manually, corresponds to ADB
    'ADB': 1,
    'ERTH': 1,
    'INF': 1,
    'M': 1,
    'RE': 1,
    'WWD': 1,
    'W': 2,   # added manually, corresponds to any W-X
    'W1': 2,  # added manually, was not available in paper
    'W2': 2,
    'WLI': 2,
    'WS': 2,
    'BRK': 3,
    'CB': 3,
    'DS': 3,
    'STN': 3,
    'RS' : 2, # added manually, was not available in paper
    'RS1': 2,  # added manually, was not available in paper
    'RS2': 3,  # added manually, was not available in paper
    'RS3': 3,  # added manually, was not available in paper
    'RS4': 3,  # added manually, was not available in paper
    'UCB': 4,
    'UFB': 4,
    'BTLR': 4,
    'C': 4,  # added manually, corresponds to any C-X
    'C2': 4,
    'C3': 4,
    'MCF': 4,
    'RC': 4,
    'RM': 4,
    'S': 4,
    'C1H': 4,  # added manually, was not available in paper
    'C1L': 4,  # added manually, was not available in paper
    'C1M': 4,  # added manually, was not available in paper
    'RM2L': 4,  # added manually, was not available in paper
    'RM2M': 4,  # added manually, was not available in paper
    'S1H': 4,  # added manually, was not available in paper
    'S1L': 4,  # added manually, was not available in paper
    'S1M': 4,  # added manually, was not available in paper
    'S3': 4,  # added manually, was not available in paper
    'S4H': 4,  # added manually, was not available in paper
    'S4L': 4,  # added manually, was not available in paper
    'S4M': 4}  # added manually, was not available in paper

# =============================================================================
# Bulding-type wise Flood impact functions
# from https://nhess.copernicus.org/articles/19/1703/2019/
# =============================================================================

impf_fl_I = ImpactFunc(
    id=1,
    name='Flood impact function class I',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    paa=np.linspace(1, 1, num=11),
    mdd=np.array([0, 0.5, 0.9, 1, 1, 1, 1, 1, 1, 1, 1]),
)

impf_fl_II = ImpactFunc(
    id=2,
    name='Flood impact function class II',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    paa=np.linspace(1, 1, num=11),
    mdd=np.array([0, 0.45, 0.7, 0.85, 0.95, 1, 1, 1, 1, 1, 1]),
)


impf_fl_IIIa = ImpactFunc(
    id=3,
    name='Flood impact function class III - one storey',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    paa=np.linspace(1, 1, num=11),
    mdd=np.array([0, 0.4, 0.55, 0.7, 0.78, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8]),
)

impf_fl_IIIb = ImpactFunc(
    id=5,
    name='Flood impact function class III - two storeys',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    paa=np.linspace(1, 1, num=11),
    mdd=np.array([0, 0.25, 0.4, 0.5, 0.58, 0.65, 0.7, 0.75, 0.78, 0.8, 0.8]),
)

impf_fl_IVa = ImpactFunc(
    id=4,
    name='Flood impact function class IV - one storey',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    paa=np.linspace(1, 1, num=11),
    mdd=np.array([0, 0.35, 0.45, 0.55, 0.62, 0.65,
                 0.65, 0.65, 0.65, 0.65, 0.65]),
)


impf_fl_IVb = ImpactFunc(
    id=6,
    name='Flood impact function class IV - two storeys',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.linspace(0, 5, num=11),
    paa=np.linspace(1, 1, num=11),
    mdd=np.array([0, 0.2, 0.3, 0.4, 0.45, 0.5, 0.55, 0.6, 0.63, 0.65, 0.65]),
)

IMPF_SET_FL_IVM = ImpactFuncSet([impf_fl_I, impf_fl_II, impf_fl_IIIa,
                                 impf_fl_IIIb, impf_fl_IVa, impf_fl_IVb])


# =============================================================================
# Conversion from PAGER building classification to CIMA (CAPRA? JRC?)
# building type classification from excel file
# =============================================================================
DICT_PAGER2CIMA = {'A': 'T1',
                   'A1': 'T1',
                   'A2': 'T1',
                   'A3': 'T1',
                   'A4': 'T1',
                   'C': 'C1',
                   'C1': 'C1',
                   'C1H': 'C1',
                   'C1L': 'C1',
                   'C1M': 'C1',
                   'C2': 'C2',
                   'C2L': 'C2',
                   'C3': 'C4',
                   'C3L': 'C4',
                   'C3M': 'C4',
                   'C4': 'C4',
                   'CH': 'C1',
                   'CL': 'C1',
                   'CM': 'C1',
                   'DS': 'M1',
                   'DS1': 'M1',
                   'DS2': 'M1',
                   'DS3': 'M1',
                   'DS4': 'M1',
                   'INF': 'W1',
                   'M': 'T1',
                   'M2': 'T1',
                   'MH': 'W1',
                   'MS': 'M1',
                   'PC': 'C5',
                   'PC1': 'C5',
                   'PC2': 'C5',
                   'PC2L': 'C5',
                   'RE': 'T1',
                   'RM': 'M1',
                   'RM1': 'M1',
                   'RM1L': 'M1',
                   'RM2': 'M2',
                   'RM2H': 'M2',
                   'RM2L': 'M2',
                   'RM2M': 'M2',
                   'RS': 'M1',
                   'RS1': 'M1',
                   'RS2': 'M1',
                   'RS3': 'M1',
                   'RS4': 'M1',
                   'RS5': 'M1',
                   'S': 'C1',
                   'S1': 'C1',
                   'S1H': 'C1',
                   'S1L': 'C1',
                   'S1M': 'C1',
                   'S2': 'C2',
                   'S2L': 'C2',
                   'S3': 'C4',
                   'S4': 'C4',
                   'S4H': 'C4',
                   'S4L': 'C4',
                   'S4M': 'C4',
                   'S5': 'C5',
                   'S5L': 'C5',
                   'UCB': 'M1',
                   'UFB': 'M1',
                   'UFB1': 'M1',
                   'UFB2': 'M1',
                   'UFB3': 'M1',
                   'UFB4': 'M1',
                   'UNK': 'T1',
                   'W': 'W1',
                   'W1': 'W1',
                   'W2': 'W2',
                   'W4': 'W2'}

DICT_CIMA_FLIMPF_CIMA = {'C1': 1,
                         'C2': 2,
                         'C4': 3,
                         'C5': 4,
                         'C30': 5,
                         'M1': 6,
                         'M2': 7,
                         'M3': 8,
                         'M4': 9,
                         'M5': 10,
                         'R1': 11,
                         'T1': 12,
                         'T2': 13,
                         'W1': 14,
                         'W2': 15}

DICT_PAGER_FLIMPF_CIMA = {'A': 12,
                          'A1': 12,
                          'A2': 12,
                          'A3': 12,
                          'A4': 12,
                          'C': 1,
                          'C1': 1,
                          'C1H': 1,
                          'C1L': 1,
                          'C1M': 1,
                          'C2': 2,
                          'C2L': 2,
                          'C3': 3,
                          'C3L': 3,
                          'C3M': 3,
                          'C4': 3,
                          'CH': 1,
                          'CL': 1,
                          'CM': 1,
                          'DS': 6,
                          'DS1': 6,
                          'DS2': 6,
                          'DS3': 6,
                          'DS4': 6,
                          'INF': 14,
                          'M': 12,
                          'M2': 12,
                          'MH': 14,
                          'MS': 6,
                          'PC': 4,
                          'PC1': 4,
                          'PC2': 4,
                          'PC2L': 4,
                          'RE': 12,
                          'RM': 6,
                          'RM1': 6,
                          'RM1L': 6,
                          'RM2': 7,
                          'RM2H': 7,
                          'RM2L': 7,
                          'RM2M': 7,
                          'RS': 6,
                          'RS1': 6,
                          'RS2': 6,
                          'RS3': 6,
                          'RS4': 6,
                          'RS5': 6,
                          'S': 1,
                          'S1': 1,
                          'S1H': 1,
                          'S1L': 1,
                          'S1M': 1,
                          'S2': 2,
                          'S2L': 2,
                          'S3': 3,
                          'S4': 3,
                          'S4H': 3,
                          'S4L': 3,
                          'S4M': 3,
                          'S5': 4,
                          'S5L': 4,
                          'UCB': 6,
                          'UFB': 6,
                          'UFB1': 6,
                          'UFB2': 6,
                          'UFB3': 6,
                          'UFB4': 6,
                          'UNK': 12,
                          'W': 14,
                          'W1': 14,
                          'W2': 15,
                          'W4': 15}


# =============================================================================
# Bulding-type wise Flood impact functions
# from CIMA (CAPRA? JRC?)
# =============================================================================


impf_fl_c1 = ImpactFunc(
    id=1,
    name='Flood impact function class C1',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0, 0.0966, 0.1931, 0.2897, 0.3862, 0.4828, 0.5793, 0.6759,
                        0.7724, 0.869, 0.9655, 1.0621, 1.1586, 1.2552, 1.3517,
                        1.4483, 1.5448, 1.6414, 1.7379, 1.8345, 1.931, 2.0276,
                        2.1241, 2.2207, 2.3172, 2.4138, 2.5103, 2.6069,
                        2.7034, 2.8]),
    mdd=np.array([0, 0, 0, 0, 0.0006, 0.0024, 0.0048, 0.009, 0.0156, 0.0258,
                  0.0402, 0.0594, 0.0846,
                  0.1158,
                  0.153,
                  0.1962,
                  0.2442,
                  0.2952,
                  0.348,
                  0.399,
                  0.4464,
                  0.4884,
                  0.5232,
                  0.5502,
                  0.5694,
                  0.5832,
                  0.591,
                  0.5958,
                  0.5982,
                  0.6]),
    paa=np.linspace(1, 1, num=30))

impf_fl_c2 = ImpactFunc(
    id=2,
    name='Flood impact function C2',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.1931,
                        0.3862,
                        0.5793,
                        0.7724,
                        0.9655,
                        1.1586,
                        1.3517,
                        1.5448,
                        1.7379,
                        1.931,
                        2.1241,
                        2.3172,
                        2.5103,
                        2.7034,
                        2.8966,
                        3.0897,
                        3.2828,
                        3.4759,
                        3.669,
                        3.8621,
                        4.0552,
                        4.2483,
                        4.4414,
                        4.6345,
                        4.8276,
                        5.0207,
                        5.2138,
                        5.4069,
                        5.6]),
    mdd=np.array([0,
                  0,
                  0.0006,
                  0.0024,
                  0.0078,
                  0.0198,
                  0.042,
                  0.0762,
                  0.1218,
                  0.174,
                  0.2232,
                  0.2616,
                  0.285,
                  0.2958,
                  0.2988,
                  0.3,
                  0.3,
                  0.3012,
                  0.3042,
                  0.3132,
                  0.33,
                  0.3576,
                  0.3978,
                  0.4476,
                  0.4992,
                  0.5442,
                  0.5748,
                  0.5916,
                  0.5976,
                  0.6]),
    paa=np.linspace(1, 1, num=30),
)
impf_fl_c4 = ImpactFunc(
    id=3,
    name='Flood impact function C4',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.3448,
                        0.6897,
                        1.0345,
                        1.3793,
                        1.7241,
                        2.069,
                        2.4138,
                        2.7586,
                        3.1034,
                        3.4483,
                        3.7931,
                        4.1379,
                        4.4828,
                        4.8276,
                        5.1724,
                        5.5172,
                        5.8621,
                        6.2069,
                        6.5517,
                        6.8966,
                        7.2414,
                        7.5862,
                        7.931,
                        8.2759,
                        8.6207,
                        8.9655,
                        9.3103,
                        9.6552,
                        10]),
    mdd=np.array([0,
                  0,
                  0.0024,
                  0.0132,
                  0.0414,
                  0.0852,
                  0.126,
                  0.1458,
                  0.15,
                  0.15,
                  0.1518,
                  0.1614,
                  0.1866,
                  0.2292,
                  0.2718,
                  0.2946,
                  0.2994,
                  0.3,
                  0.3012,
                  0.3096,
                  0.3324,
                  0.3738,
                  0.4176,
                  0.4428,
                  0.4494,
                  0.45,
                  0.4512,
                  0.4578,
                  0.4788,
                  0.5184]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_c5 = ImpactFunc(
    id=4,
    name='Flood impact function C5',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.3448,
                        0.6897,
                        1.0345,
                        1.3793,
                        1.7241,
                        2.069,
                        2.4138,
                        2.7586,
                        3.1034,
                        3.4483,
                        3.7931,
                        4.1379,
                        4.4828,
                        4.8276,
                        5.1724,
                        5.5172,
                        5.8621,
                        6.2069,
                        6.5517,
                        6.8966,
                        7.2414,
                        7.5862,
                        7.931,
                        8.2759,
                        8.6207,
                        8.9655,
                        9.3103,
                        9.6552,
                        10]),
    mdd=np.array([0,
                  0,
                  0.0018,
                  0.0108,
                  0.033,
                  0.0678,
                  0.1008,
                  0.1164,
                  0.12,
                  0.12,
                  0.1212,
                  0.129,
                  0.1494,
                  0.1836,
                  0.2178,
                  0.2358,
                  0.2394,
                  0.24,
                  0.2412,
                  0.2478,
                  0.2664,
                  0.2988,
                  0.3342,
                  0.3546,
                  0.3594,
                  0.36,
                  0.3606,
                  0.366,
                  0.3834,
                  0.4146]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_c30 = ImpactFunc(
    id=5,
    name='Flood impact function C30',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.3448,
                        0.6897,
                        1.0345,
                        1.3793,
                        1.7241,
                        2.069,
                        2.4138,
                        2.7586,
                        3.1034,
                        3.4483,
                        3.7931,
                        4.1379,
                        4.4828,
                        4.8276,
                        5.1724,
                        5.5172,
                        5.8621,
                        6.2069,
                        6.5517,
                        6.8966,
                        7.2414,
                        7.5862,
                        7.931,
                        8.2759,
                        8.6207,
                        8.9655,
                        9.3103,
                        9.6552,
                        10]),
    mdd=np.array([0,
                  0,
                  0.0012,
                  0.0042,
                  0.0096,
                  0.0162,
                  0.0228,
                  0.027,
                  0.0294,
                  0.03,
                  0.0312,
                  0.0336,
                  0.039,
                  0.0456,
                  0.0522,
                  0.057,
                  0.0588,
                  0.06,
                  0.0606,
                  0.0636,
                  0.0684,
                  0.075,
                  0.0816,
                  0.0864,
                  0.0888,
                  0.09,
                  0.0906,
                  0.093,
                  0.0978,
                  0.1038]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_m1 = ImpactFunc(
    id=6,
    name='Flood impact function M1',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.0966,
                        0.1931,
                        0.2897,
                        0.3862,
                        0.4828,
                        0.5793,
                        0.6759,
                        0.7724,
                        0.869,
                        0.9655,
                        1.0621,
                        1.1586,
                        1.2552,
                        1.3517,
                        1.4483,
                        1.5448,
                        1.6414,
                        1.7379,
                        1.8345,
                        1.931,
                        2.0276,
                        2.1241,
                        2.2207,
                        2.3172,
                        2.4138,
                        2.5103,
                        2.6069,
                        2.7034,
                        2.8]),
    mdd=np.array([0,
                  0,
                  0.0006,
                  0.0024,
                  0.0054,
                  0.0102,
                  0.018,
                  0.0282,
                  0.0414,
                  0.0576,
                  0.078,
                  0.1014,
                  0.1278,
                  0.1578,
                  0.1902,
                  0.2244,
                  0.2604,
                  0.297,
                  0.333,
                  0.3684,
                  0.4026,
                  0.4344,
                  0.4632,
                  0.489,
                  0.5118,
                  0.5316,
                  0.5478,
                  0.561,
                  0.5718,
                  0.6]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_m2 = ImpactFunc(
    id=7,
    name='Flood impact function M2',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.1931,
                        0.3862,
                        0.5793,
                        0.7724,
                        0.9655,
                        1.1586,
                        1.3517,
                        1.5448,
                        1.7379,
                        1.931,
                        2.1241,
                        2.3172,
                        2.5103,
                        2.7034,
                        2.8966,
                        3.0897,
                        3.2828,
                        3.4759,
                        3.669,
                        3.8621,
                        4.0552,
                        4.2483,
                        4.4414,
                        4.6345,
                        4.8276,
                        5.0207,
                        5.2138,
                        5.4069,
                        5.6]),
    mdd=np.array([0,
                  0.0006,
                  0.0024,
                  0.009,
                  0.0204,
                  0.039,
                  0.0642,
                  0.0948,
                  0.1302,
                  0.1668,
                  0.201,
                  0.2316,
                  0.2562,
                  0.2736,
                  0.2856,
                  0.3,
                  0.3012,
                  0.3054,
                  0.3138,
                  0.3288,
                  0.3504,
                  0.3786,
                  0.4122,
                  0.4482,
                  0.4842,
                  0.5172,
                  0.5448,
                  0.5658,
                  0.5808,
                  0.6]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_m3 = ImpactFunc(
    id=8,
    name='Flood impact function M3',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.2897,
                        0.5793,
                        0.869,
                        1.1586,
                        1.4483,
                        1.7379,
                        2.0276,
                        2.3172,
                        2.6069,
                        2.8966,
                        3.1862,
                        3.4759,
                        3.7655,
                        4.0552,
                        4.3448,
                        4.6345,
                        4.9241,
                        5.2138,
                        5.5034,
                        5.7931,
                        6.0828,
                        6.3724,
                        6.6621,
                        6.9517,
                        7.2414,
                        7.531,
                        7.8207,
                        8.1103,
                        8.4]),
    mdd=np.array([0,
                  0.0006,
                  0.006,
                  0.0192,
                  0.0426,
                  0.075,
                  0.111,
                  0.1446,
                  0.1704,
                  0.1872,
                  0.1998,
                  0.2016,
                  0.2094,
                  0.2262,
                  0.2526,
                  0.2868,
                  0.3228,
                  0.3546,
                  0.3774,
                  0.3906,
                  0.4002,
                  0.4032,
                  0.414,
                  0.4338,
                  0.4632,
                  0.4992,
                  0.534,
                  0.5628,
                  0.5826,
                  0.6]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_m4 = ImpactFunc(
    id=9,
    name='Flood impact function M4',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.3448,
                        0.6897,
                        1.0345,
                        1.3793,
                        1.7241,
                        2.069,
                        2.4138,
                        2.7586,
                        3.1034,
                        3.4483,
                        3.7931,
                        4.1379,
                        4.4828,
                        4.8276,
                        5.1724,
                        5.5172,
                        5.8621,
                        6.2069,
                        6.5517,
                        6.8966,
                        7.2414,
                        7.5862,
                        7.931,
                        8.2759,
                        8.6207,
                        8.9655,
                        9.3103,
                        9.6552,
                        10]),
    mdd=np.array([0,
                  0.0012,
                  0.0072,
                  0.0234,
                  0.0498,
                  0.0822,
                  0.1116,
                  0.1326,
                  0.144,
                  0.1506,
                  0.156,
                  0.171,
                  0.1962,
                  0.228,
                  0.2586,
                  0.2808,
                  0.2934,
                  0.3006,
                  0.3048,
                  0.3186,
                  0.3426,
                  0.3744,
                  0.405,
                  0.429,
                  0.4422,
                  0.45,
                  0.4542,
                  0.4662,
                  0.4896,
                  0.5202]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_m5 = ImpactFunc(
    id=10,
    name='Flood impact function M5',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.3448,
                        0.6897,
                        1.0345,
                        1.3793,
                        1.7241,
                        2.069,
                        2.4138,
                        2.7586,
                        3.1034,
                        3.4483,
                        3.7931,
                        4.1379,
                        4.4828,
                        4.8276,
                        5.1724,
                        5.5172,
                        5.8621,
                        6.2069,
                        6.5517,
                        6.8966,
                        7.2414,
                        7.5862,
                        7.931,
                        8.2759,
                        8.6207,
                        8.9655,
                        9.3103,
                        9.6552,
                        10]),
    mdd=np.array([0,
                  0.0006,
                  0.006,
                  0.0186,
                  0.0402,
                  0.0654,
                  0.0894,
                  0.1062,
                  0.1152,
                  0.1206,
                  0.1248,
                  0.1368,
                  0.1572,
                  0.1824,
                  0.207,
                  0.225,
                  0.2346,
                  0.2406,
                  0.2442,
                  0.255,
                  0.2742,
                  0.2994,
                  0.324,
                  0.3432,
                  0.354,
                  0.36,
                  0.3636,
                  0.3732,
                  0.3918,
                  0.4164]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_r1 = ImpactFunc(
    id=11,
    name='Flood impact function R1',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.097,
                        0.193,
                        0.29,
                        0.386,
                        0.483,
                        0.579,
                        0.676,
                        0.772,
                        0.869,
                        0.966,
                        1.062,
                        1.159,
                        1.255,
                        1.352,
                        1.448,
                        1.545,
                        1.641,
                        1.738,
                        1.835,
                        1.931,
                        2.028,
                        2.124,
                        2.221,
                        2.317,
                        2.414,
                        2.51,
                        2.607,
                        2.703,
                        2.8]),
    mdd=np.array([0,
                  0,
                  0.002,
                  0.008,
                  0.019,
                  0.037,
                  0.062,
                  0.097,
                  0.141,
                  0.195,
                  0.257,
                  0.327,
                  0.402,
                  0.48,
                  0.558,
                  0.634,
                  0.704,
                  0.768,
                  0.824,
                  0.87,
                  0.907,
                  0.936,
                  0.958,
                  0.973,
                  0.984,
                  0.99,
                  0.995,
                  0.997,
                  0.999,
                  1]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_t1 = ImpactFunc(
    id=12,
    name='Flood impact function T1',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.097,
                        0.193,
                        0.29,
                        0.386,
                        0.483,
                        0.579,
                        0.676,
                        0.772,
                        0.869,
                        0.966,
                        1.062,
                        1.159,
                        1.255,
                        1.352,
                        1.448,
                        1.545,
                        1.641,
                        1.738,
                        1.835,
                        1.931,
                        2.028,
                        2.124,
                        2.221,
                        2.317,
                        2.414,
                        2.51,
                        2.607,
                        2.703,
                        2.8]),
    mdd=np.array([0,
                  0.001,
                  0.006,
                  0.021,
                  0.048,
                  0.092,
                  0.154,
                  0.234,
                  0.328,
                  0.432,
                  0.54,
                  0.644,
                  0.738,
                  0.818,
                  0.881,
                  0.927,
                  0.958,
                  0.978,
                  0.989,
                  0.995,
                  0.998,
                  0.999,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_t2 = ImpactFunc(
    id=13,
    name='Flood impact function T1',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.0966,
                        0.1931,
                        0.2897,
                        0.3862,
                        0.4828,
                        0.5793,
                        0.6759,
                        0.7724,
                        0.869,
                        0.9655,
                        1.0621,
                        1.1586,
                        1.2552,
                        1.3517,
                        1.4483,
                        1.5448,
                        1.6414,
                        1.7379,
                        1.8345,
                        1.931,
                        2.0276,
                        2.1241,
                        2.2207,
                        2.3172,
                        2.4138,
                        2.5103,
                        2.6069,
                        2.7034,
                        2.8]),
    mdd=np.array([0,
                  0.001,
                  0.006,
                  0.021,
                  0.048,
                  0.092,
                  0.154,
                  0.234,
                  0.328,
                  0.432,
                  0.54,
                  0.644,
                  0.738,
                  0.818,
                  0.881,
                  0.927,
                  0.958,
                  0.978,
                  0.989,
                  0.995,
                  0.998,
                  0.999,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_t2 = ImpactFunc(
    id=13,
    name='Flood impact function T2',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.0966,
                        0.1931,
                        0.2897,
                        0.3862,
                        0.4828,
                        0.5793,
                        0.6759,
                        0.7724,
                        0.869,
                        0.9655,
                        1.0621,
                        1.1586,
                        1.2552,
                        1.3517,
                        1.4483,
                        1.5448,
                        1.6414,
                        1.7379,
                        1.8345,
                        1.931,
                        2.0276,
                        2.1241,
                        2.2207,
                        2.3172,
                        2.4138,
                        2.5103,
                        2.6069,
                        2.7034,
                        2.8]),
    mdd=np.array([0,
                  0.001,
                  0.006,
                  0.021,
                  0.048,
                  0.092,
                  0.154,
                  0.234,
                  0.328,
                  0.432,
                  0.54,
                  0.644,
                  0.738,
                  0.818,
                  0.881,
                  0.927,
                  0.958,
                  0.978,
                  0.989,
                  0.995,
                  0.998,
                  0.999,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_w1 = ImpactFunc(
    id=14,
    name='Flood impact function W1',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.097,
                        0.193,
                        0.29,
                        0.386,
                        0.483,
                        0.579,
                        0.676,
                        0.772,
                        0.869,
                        0.966,
                        1.062,
                        1.159,
                        1.255,
                        1.352,
                        1.448,
                        1.545,
                        1.641,
                        1.738,
                        1.835,
                        1.931,
                        2.028,
                        2.124,
                        2.221,
                        2.317,
                        2.414,
                        2.51,
                        2.607,
                        2.703,
                        2.8]),
    mdd=np.array([0,
                  0,
                  0.002,
                  0.008,
                  0.019,
                  0.037,
                  0.062,
                  0.097,
                  0.141,
                  0.195,
                  0.257,
                  0.327,
                  0.402,
                  0.48,
                  0.558,
                  0.634,
                  0.704,
                  0.768,
                  0.824,
                  0.87,
                  0.907,
                  0.936,
                  0.958,
                  0.973,
                  0.984,
                  0.99,
                  0.995,
                  0.997,
                  0.999,
                  1]),
    paa=np.linspace(1, 1, num=30),
)

impf_fl_w2 = ImpactFunc(
    id=15,
    name='Flood impact function W2',
    intensity_unit='metres',
    haz_type='FL',
    intensity=np.array([0,
                        0.193,
                        0.386,
                        0.579,
                        0.772,
                        0.966,
                        1.159,
                        1.352,
                        1.545,
                        1.738,
                        1.931,
                        2.124,
                        2.317,
                        2.51,
                        2.703,
                        2.897,
                        3.09,
                        3.283,
                        3.476,
                        3.669,
                        3.862,
                        4.055,
                        4.248,
                        4.441,
                        4.635,
                        4.828,
                        5.021,
                        5.214,
                        5.407,
                        5.6]),
    mdd=np.array([0,
                  0.001,
                  0.009,
                  0.031,
                  0.071,
                  0.129,
                  0.201,
                  0.279,
                  0.352,
                  0.412,
                  0.454,
                  0.479,
                  0.492,
                  0.497,
                  0.499,
                  0.5,
                  0.504,
                  0.518,
                  0.549,
                  0.597,
                  0.663,
                  0.74,
                  0.817,
                  0.884,
                  0.935,
                  0.968,
                  0.987,
                  0.995,
                  0.999,
                  1]),
    paa=np.linspace(1, 1, num=30),
)

IMPF_SET_FL_CIMA = ImpactFuncSet([impf_fl_c1, impf_fl_c2, impf_fl_c4, impf_fl_c5,
                                 impf_fl_c30, impf_fl_m1, impf_fl_m2, impf_fl_m3,
                                 impf_fl_m4, impf_fl_m5, impf_fl_r1, impf_fl_t1,
                                 impf_fl_t2, impf_fl_w1, impf_fl_w2])


# =============================================================================
# Conversion from PAGER building classification to HAZUS building classification
# =============================================================================

# min. med and max refers to which columns in the sigmoid-fitted csv files to take
DICT_PAGER2HAZUS = {
    'A': 'adobe_med',  # added manually, corresponds to ADB
    'A1': 'adobe_med',  # added manually, corresponds to ADB
    'A2': 'adobe_min',  # new key
    'A3': 'adobe_med',  # new key
    'A4': 'adobe_med',  # new key
    'ADB': 'adobe_med',
    'BRK': 'reinforced_masonery_med',  # All stone / block / brick masonery classified as reinforced masonery
    'BTLR': 'reinforced_masonery_med',
    'C': 'reinforced_concrete_med',  # added manually, corresponds to any C-X
    'C1': 'reinforced_concrete_min',  # added manually, corresponds to any C-X
    'C1H': 'reinforced_concrete_min',
    'C1L': 'reinforced_concrete_min',
    'C1M': 'reinforced_concrete_min',
    'C2': 'reinforced_concrete_med',
    'C2L': 'reinforced_concrete_med',  # new key
    'C3': 'reinforced_concrete_med',
    'C3L': 'reinforced_concrete_med',  # new key
    'C3M': 'reinforced_concrete_med',  # new key
    'C4': 'reinforced_concrete_med',  # new key
    'CB': 'reinforced_concrete_min',  # All stone / block / brick masonery classified as reinforced masonery
    'CH': 'reinforced_concrete_min',  # new key
    'CL': 'reinforced_concrete_min',  # new key
    'CM': 'reinforced_concrete_min',  # new key
    'DS': 'reinforced_masonery_med',  # All stone / block / brick masonery classified as reinforced masonery
    'DS1': 'reinforced_masonery_med',  # new key
    'DS2': 'reinforced_masonery_med',  # new key
    'DS3': 'reinforced_masonery_med',  # new key
    'DS4': 'reinforced_masonery_max',  # new key
    'EARTH': 'adobe_min',
    'INF': 'adobe_min',
    'M': 'adobe_med',
    'M2': 'adobe_med',  # new key
    'MCF': 'reinforced_concrete_med',
    'MH': 'wood_min',  # new key
    'MS': 'reinforced_masonery_min',  # new key
    'PC': 'precast_concrete',  # new key
    'PC1': '',  # new key
    'PC2': '',  # new key
    'PC2L': '',  # new key
    'RC': 'reinforced_concrete_med',
    'RE': 'adobe_med',
    'RM': 'reinforced_masonery_med',
    'RM1': '',  # new key
    'RM1L': '',  # new key
    'RM2': '',  # new key
    'RM2H': '',  # new key
    'RM2L': 'reinforced_masonery_med',
    'RM2M': 'reinforced_masonery_med',
    'RS': 'reinforced_masonery_min',  # All stone / block / brick masonery classified as reinforced masonery
    'RS1': 'reinforced_masonery_min',  # All stone / block / brick masonery classified as reinforced masonery
    'RS2': 'reinforced_masonery_min',  # All stone / block / brick masonery classified as reinforced masonery
    'RS3': 'reinforced_masonery_min',  # All stone / block / brick masonery classified as reinforced masonery
    'RS4': 'reinforced_masonery_med',  # All stone / block / brick masonery classified as reinforced masonery
    'RS5': 'reinforced_masonery_med',  # new key
    'S': 'steel_med',
    'S1': 'steel_min',  # new key
    'S1H': 'steel_min',
    'S1L': 'steel_min',
    'S1M': 'steel_min',
    'S2': 'steel_med',  # new key
    'S2L': 'steel_med',  # new key
    'S3': 'steel_med',
    'S4': 'steel_max',  # new key
    'S4H': 'steel_max',
    'S4L': 'steel_max',
    'S4M': 'steel_max',
    'S5': 'steel_min',  # new key
    'S5L': 'steel_min',  # new key
    'STN': 'reinforced_masonery_med',  # All stone / block / brick masonery classified as reinforced masonery
    'UCB': 'reinforced_masonery_max',
    'UFB': 'reinforced_masonery_med',  # All stone / block / brick masonery classified as reinforced masonery
    'UFB1': 'reinforced_masonery_med',  # added manually, corresponds to any UFB
    'UFB2': 'reinforced_masonery_med',  # added manually, corresponds to any UFB
    'UFB3': 'reinforced_masonery_med',  # added manually, corresponds to any UFB
    'UFB4': 'reinforced_masonery_med',  # added manually, corresponds to any UFB
    'UNK': '',  # new key
    'W': 'wood_med',  # added manually, corresponds to any W-X
    'W1': 'wood_min',
    'W2': 'wood_max',
    'W4': 'wood_max',  # new key
    'WLI': 'wood_med',
    'WS': 'wood_med',
    'WWD': 'wood_med'
}

DICT_HAZUS_IMPF_TC_HAZUS = {
    'reinforced_concrete_min': 1,
    'reinforced_concrete_med': 2,
    'reinforced_concrete_max': 3,
    'reinforced_masonery_min': 4,
    'reinforced_masonery_med': 5,
    'reinforced_masonery_max': 6,
    'steel_min': 7,
    'steel_med': 8,
    'steel_max': 9,
    'wood_min': 10,
    'wood_med': 11,
    'wood_max': 12,
    'adobe_min': 13,
    'adobe_max': 14,
    'adobe_med': 15,
}

DICT_PAGER_TCIMPF_HAZUS = {key: DICT_HAZUS_IMPF_TC_HAZUS[value]
                           for key, value in DICT_PAGER2HAZUS.items()}


def if_fom_sig_funcs_hazus(bldg_sub_type):
    bldg_type = bldg_sub_type[:-4]
    sub_type = bldg_sub_type[-3:]
    df_hazus_impf = pd.read_csv(PATH_CSV_TC_AGG)
    v_thresh = df_hazus_impf[df_hazus_impf.building_type ==
                             bldg_type][f'v_thresh_{sub_type}'].values[0]
    v_half = df_hazus_impf[df_hazus_impf.building_type ==
                           bldg_type][f'v_half_{sub_type}'].values[0]

    return ImpfTropCyclone.from_emanuel_usa(
        impf_id=DICT_HAZUS_IMPF_TC_HAZUS[f'{bldg_type}_{sub_type}'],
        intensity=np.arange(0, 121, 2),
        v_thresh=v_thresh, v_half=v_half, scale=1.0)


IMPF_SET_TC_HAZUS = ImpactFuncSet([if_fom_sig_funcs_hazus(bldg_sub)
                                   for bldg_sub in DICT_HAZUS_IMPF_TC_HAZUS.keys()])
